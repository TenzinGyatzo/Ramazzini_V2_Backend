---
wave: 6
depends_on: []
files_modified:
  - .planning/phases/04-audit-trail/DEFERRED.md
  - .planning/phases/04-audit-trail/CONTEXT.md
  - .planning/ROADMAP.md
autonomous: true
---

# Plan 04-07 — Capa 7: Deuda diferida explícita (fuera de alcance Phase 4)

**Objetivo:** Documentar en un único artefacto (DEFERRED.md) todo lo que queda fuera del alcance de Phase 4 para no perderlo y para que ejecutores futuros no amplíen el alcance. Actualizar ROADMAP Phase 4 para referenciar los planes y la deuda diferida.

**No implementar** ninguna de las ideas diferidas en este plan; solo documentar.

---

## must_haves

- [ ] **Crear DEFERRED.md** en `.planning/phases/04-audit-trail/DEFERRED.md` con secciones:
  - **Auditar lecturas genéricas:** vistas de pantalla, listados (no solo descarga GIIS y audit). CONTEXT D1: solo escrituras + lecturas sensibles en v1.
  - **Firma digital del servidor / sellado periódico:** D4 dejó sin firma ni sellado en v1; evolución posible para no repudio adicional.
  - **Archivado automático por antigüedad:** D6: sin borrado en v1; archivado automático diferido.
  - **Versionado por delta:** D2: documento completo por versión en v1; versionado por delta (campo a campo) diferido.
  - **Proceso de drenado de audit_outbox:** Clase 2 escribe en outbox y alerta; worker o job que reintente escribir en AuditEvent no está en alcance v1; documentar como evolución.
- [ ] **Referencia en CONTEXT:** Añadir al final de CONTEXT.md una línea: "Deuda diferida (fuera de Phase 4): ver DEFERRED.md en esta carpeta."
- [ ] **Actualizar ROADMAP:** En Phase 4, reemplazar "Plans: TBD" por la lista de planes 04-01 a 04-07 con breve descripción. En Details, añadir: "Planes por capas: 01 cimientos, 02 datos, 03 instrumentación, 04 API/UI, 05 export verificable, 06 pruebas NOM-024, 07 deuda diferida. Deuda: DEFERRED.md."

---

## Tasks

<task>
**Task 04-07.1 — Redactar DEFERRED.md**
- Crear archivo con las secciones listadas en must_haves. Tono breve: título, una o dos frases por ítem, referencia a decisión (D1, D2, D4, D6) o CONTEXT donde corresponda.
</task>

<task>
**Task 04-07.2 — Enlazar en CONTEXT y ROADMAP**
- En CONTEXT.md (al final, antes o después del pie): "Deuda diferida (fuera de Phase 4): ver DEFERRED.md en esta carpeta."
- En ROADMAP.md, sección Phase 4: Plans: 04-01 … 04-07 con descripción de una línea cada uno. Details: "Capas: 01 cimientos, 02 datos, 03 instrumentación, 04 API/UI, 05 export, 06 pruebas, 07 deuda. Ver DEFERRED.md para alcance diferido."
</task>

---

## Verification

- DEFERRED.md existe y contiene las cinco áreas (lecturas genéricas, firma/sellado, archivado, delta, drenado outbox).
- ROADMAP Phase 4 lista los 7 planes y referencia DEFERRED.md.
- No se añade código ni funcionalidad nueva; solo documentación.

---

## Criterios de aceptación NOM-024 (este plan)

- Alcance de Phase 4 cerrado y explícito; evolución futura trazable en DEFERRED.md.
