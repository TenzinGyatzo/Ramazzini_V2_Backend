---
wave: 3
depends_on: [05-02, 05-03]
files_modified:
  - frontend/src/views/AuditoriaView.vue
  - frontend/src/api/auditAPI.ts
autonomous: false
---

# Plan 05-04 — UI de auditoría: nuevos tipos de evento y filtro

**Objetivo:** Asegurar que la vista de auditoría muestre los nuevos eventos (usuarios y firmantes) en la misma lista y que los filtros opcionales por tipo incluyan los nuevos actionType. Resumen por fila: a criterio del implementador, manteniendo consistencia con el resto de eventos (05-CONTEXT).

**Contexto (05-CONTEXT.md):** Una sola lista/timeline con todos los tipos; filtros opcionales por tipo. Mismos roles que Phase 4. No restricción adicional por tipo de evento.

---

## must_haves

- [ ] **Backend:** La API de consulta de eventos ya soporta query.actionType (QueryAuditEventsDto). No requiere cambios para que los nuevos tipos (USER_*, SIGNER_*) sean filtrables.
- [ ] **Frontend — lista:** Los eventos con actionType USER_INVITATION_SENT, USER_ACTIVATED, USER_SUSPENDED, USER_REACTIVATED, USER_DELETED, USER_PASSWORD_CHANGED, SIGNER_PROFILE_CREATED, SIGNER_PROFILE_UPDATED deben mostrarse en la misma lista que el resto (sin filtro por defecto). Si la UI actual ya pinta todos los eventos devueltos por la API, no hay cambio; si filtra por una lista blanca de actionType, ampliar la lista.
- [ ] **Frontend — filtro por tipo:** Si existe un selector (dropdown o similar) para filtrar por actionType o por "categoría", añadir opciones para los nuevos tipos (p. ej. agrupados como "Gestión de usuarios" y "Perfiles de firmantes" o listando cada actionType). Si no existe filtro por tipo, se puede añadir opcionalmente o documentar que el filtro por actionType vía query ya está disponible en la API.
- [ ] **Resumen por fila:** Para cada evento mostrado, el texto/resumen de la fila debe ser consistente con los eventos existentes. A criterio del implementador: mostrar actionType traducido o legible, resourceId y/o datos del payload (ej. email del usuario, nombre del firmante) según lo que ya haga la vista para otros tipos.

---

## Tasks

<task>
**Task 05-04.1 — Revisar AuditoriaView y auditAPI**
- Abrir frontend/src/views/AuditoriaView.vue y frontend/src/api/auditAPI.ts. Verificar si la lista de eventos usa algún filtro por actionType en frontend (lista blanca o dropdown). Si la API se llama con query params (from, to, actorId, resourceType, actionType), confirmar que no se restringe actionType a valores antiguos.
</task>

<task>
**Task 05-04.2 — Incluir nuevos tipos en la lista**
- Si la vista o la API del frontend limitan los actionType mostrados o enviados, ampliar para incluir USER_INVITATION_SENT, USER_ACTIVATED, USER_SUSPENDED, USER_REACTIVATED, USER_DELETED, USER_PASSWORD_CHANGED, SIGNER_PROFILE_CREATED, SIGNER_PROFILE_UPDATED. Si la vista simplemente muestra todos los items devueltos por el backend, no hay cambio (los nuevos eventos ya aparecerán).
</task>

<task>
**Task 05-04.3 — Filtro opcional por tipo**
- Si existe dropdown/selector de "Tipo de evento" o "Categoría", añadir opciones para los nuevos tipos (p. ej. etiquetas legibles: "Invitación usuario", "Usuario activado", "Cuenta suspendida", "Cuenta reactivada", "Usuario eliminado", "Contraseña cambiada", "Perfil firmante creado", "Perfil firmante actualizado"). Si no existe filtro, opcionalmente añadir uno que envíe actionType a la API; si no se añade, documentar en el plan que el filtro por actionType está disponible en backend para uso futuro o manual.
</task>

<task>
**Task 05-04.4 — Resumen por fila**
- Asegurar que cada fila de evento muestre un texto coherente: por ejemplo "Usuario creado (invitación) — juan@ejemplo.com" o "Perfil medicoFirmante actualizado — Dr. X". Reutilizar el patrón ya usado para DOC_*, LOGIN_*, etc. (traducción de actionType + resourceId o payload). Sin requisito estricto; mantener consistencia.
</task>

---

## Verification

- Con backend instrumentado (05-02 y 05-03), al crear/usar usuarios y firmantes, los eventos aparecen en la vista de auditoría.
- Filtro por tipo (si existe) permite acotar por los nuevos tipos.
- No se requieren permisos adicionales; mismos roles que ya ven la auditoría.

---

## must_haves (checklist final)

- [ ] Los nuevos eventos son visibles en la lista de auditoría (sin restricción en frontend que los oculte).
- [ ] Filtro por actionType incluye o puede incluir los nuevos valores (o se documenta que la API ya lo soporta).
- [ ] Resumen por fila consistente con el resto de eventos.
