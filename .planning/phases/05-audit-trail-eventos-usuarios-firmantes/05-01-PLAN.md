---
wave: 1
depends_on: []
files_modified:
  - src/modules/audit/constants/audit-action-type.ts
  - src/modules/audit/constants/audit-event-class.ts
autonomous: true
---

# Plan 05-01 — Tipos de evento y clases de criticidad (Phase 5)

**Objetivo:** Añadir los nuevos `actionType` para gestión de usuarios y perfiles de firmantes al contrato de auditoría, y mapearlos a la clase de criticidad correcta (Clase 1 hard-fail para mutaciones).

**Contexto (05-CONTEXT.md):** Eventos de usuario: invitación enviada, usuario activado, USER_SUSPENDED, USER_REACTIVATED, usuario eliminado, cambio de contraseña (solo propio). Eventos de firmante: creación y actualización de perfil (medicoFirmante, enfermeraFirmante, tecnicoFirmante). Todos son mutaciones críticas → CLASS_1_HARD_FAIL.

---

## must_haves

- [ ] **audit-action-type.ts:** Añadir constantes: `USER_INVITATION_SENT`, `USER_ACTIVATED`, `USER_SUSPENDED`, `USER_REACTIVATED`, `USER_DELETED`, `USER_PASSWORD_CHANGED`, `SIGNER_PROFILE_CREATED`, `SIGNER_PROFILE_UPDATED`. No eliminar valores existentes.
- [ ] **audit-event-class.ts:** En `ACTION_TYPE_TO_CLASS`, mapear todos los nuevos action types a `AuditEventClass.CLASS_1_HARD_FAIL`.
- [ ] **Consistencia:** El tipo `AuditActionTypeValue` se deriva del objeto; las interfaces que usan `AuditActionTypeValue` (audit-service.interface, audit-event-canonical.interface) no requieren cambios si solo referencian el tipo.

---

## Tasks

<task>
**Task 05-01.1 — Nuevos action types**
- En `src/modules/audit/constants/audit-action-type.ts`, añadir después de `AUDIT_EXPORT_DOWNLOAD`:
  - USER_INVITATION_SENT
  - USER_ACTIVATED
  - USER_SUSPENDED
  - USER_REACTIVATED
  - USER_DELETED
  - USER_PASSWORD_CHANGED
  - SIGNER_PROFILE_CREATED
  - SIGNER_PROFILE_UPDATED
- Mantener formato `KEY: 'KEY'` y `as const`.
</task>

<task>
**Task 05-01.2 — Mapeo de clase**
- En `src/modules/audit/constants/audit-event-class.ts`, en el objeto `ACTION_TYPE_TO_CLASS`, añadir una entrada por cada nuevo action type, todas con valor `AuditEventClass.CLASS_1_HARD_FAIL`.
- Importar `AuditActionType` y usar las constantes (ej. `[AuditActionType.USER_SUSPENDED]: AuditEventClass.CLASS_1_HARD_FAIL`).
</task>

---

## Verification

- `AuditActionType` incluye los 8 nuevos valores y TypeScript compila sin error.
- `ACTION_TYPE_TO_CLASS` tiene entrada para cada nuevo tipo y todas son CLASS_1_HARD_FAIL.
- Tests existentes de canonical hash o audit que usen action types siguen pasando (si los hay).

---

## must_haves (checklist final)

- [ ] USER_INVITATION_SENT, USER_ACTIVATED, USER_SUSPENDED, USER_REACTIVATED, USER_DELETED, USER_PASSWORD_CHANGED, SIGNER_PROFILE_CREATED, SIGNER_PROFILE_UPDATED en audit-action-type.ts
- [ ] Los 8 nuevos tipos mapeados a CLASS_1_HARD_FAIL en audit-event-class.ts
